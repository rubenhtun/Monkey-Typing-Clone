const bodyContent = document.querySelectorAll(".skull, .trunk, .footer"),
  mentionText = document.getElementById("mention-text"),
  inputText = document.getElementById("input-text"),
  restartBtn = document.querySelector(".restart-btn"),
  seeNoti = document.querySelector(".fa-bell"),
  announceNotify = document.querySelector(".announce-notify"),
  contact = document.querySelector(".contact"),
  contactInfo = document.querySelector(".contact-info"),
  support = document.querySelector(".support"),
  supportInfo = document.querySelector(".support-info"),
  typingResult = document.querySelector(".typing-result"),
  wpmValue = document.querySelectorAll(".wpm-value"),
  accPercent = document.querySelector(".accuracy-percent"),
  setTimer = document.querySelector("#timer"),
  paragraphs = [
    "The sun was shining on the sea, Shining with all his might: He did his very best to make The billows smooth and bright And this was odd, because it was The middle of the night.",
    "The moon was shining sulkily, Because she thought the sun Had got no business to be there After the day was done 'It's very rude of him,' she said, 'To come and spoil the fun.",
    "Two roads diverged in a yellow wood, And sorry I could not travel both And be one traveler, long I stood And looked down one as far as I could To where it bent in the undergrowth.",
    "Then took the other, as just as fair, And having perhaps the better claim, Because it was grassy and wanted wear; Though as for that the passing there Had worn them really about the same.",
    "It is a truth universally acknowledged, that a single man in possession of a good fortune, must be in want of a wife. However little known the feelings or views of such a man.",
    "May be on his first entering a neighbourhood, this truth is so well fixed in the minds of the surrounding families, that he is considered as the rightful property of some one or other of their daughters.",
    "To be, or not to be, that is the question: Whether 'tis nobler in the mind to suffer The slings and arrows of outrageous fortune, Or to take arms against a sea of troubles And by opposing end them.",
    "To die: to sleep; No more; and by a sleep to say we end The heart-ache and the thousand natural shocks That flesh is heir to, 'tis a consummation Devoutly to be wished.",
    "In Xanadu did Kubla Khan A stately pleasure-dome decree: Where Alph, the sacred river, ran Through caverns measureless to man Down to a sunless sea.",
    "So twice five miles of fertile ground With walls and towers were girdled round: And there were gardens bright with sinuous rills, Where blossomed many an incense-bearing tree; And here were ancient forests.",
  ];
let paragraphArr = [],
  inputArr = [],
  errs = 0,
  timerStarted = !1,
  activeTab;
const checkInput = () => {
  (mentionText.innerHTML = ""),
    paragraphArr.forEach((e, t) => {
      let n = document.createElement("span");
      (n.textContent = e),
        t < inputText.value.length
          ? inputText.value[t] !== e
            ? ((n.style.color = "#ca4754"), (errs += 1))
            : (n.style.color = "#EDEADE")
          : (n.style.color = "#928c87"),
        mentionText.appendChild(n);
    });
};
inputText.addEventListener("input", () => {
  let e = inputText.value[inputText.value.length - 1];
  e === paragraphArr[paragraphArr.length - 1] &&
    ((inputText.value = ""), startTyping());
});
const startTyping = () => {
  let e = paragraphs[Math.floor(Math.random() * paragraphs.length)];
  (paragraphArr = e.split("")),
    (mentionText.textContent = e),
    mentionText.classList.add("fade-out-in"),
    mentionText.addEventListener("animationend", () => {
      mentionText.classList.remove("fade-out-in");
    }),
    (errs = null),
    (timerStarted = !1);
};
startTyping();
const result = () => {
  typingResult.style.display = "flex";
  let e = activeTab.innerHTML.trim() / 60,
    t = Math.round((inputArr.length - errs) / 5 / e),
    n = Math.round(inputArr.length / 5 / e),
    r = Math.round(((inputArr.length - errs) / inputArr.length) * 100),
    a = 100 * Math.round(n / t);
  (document.querySelector(".consistency").innerHTML = `${a}%`),
    console.log(a),
    wpmValue.forEach((e) => {
      e.innerText = `${t}`;
    }),
    (accPercent.innerText = `${r}%`);
  let o = document.querySelectorAll(".time");
  o.forEach((e) => {
    e.innerHTML = `${activeTab.innerHTML.trim()}s`;
  });
};
let character = 0;
inputText.addEventListener("input", () => {
  if (
    (checkInput(),
    (inputArr = inputText.value.split("")),
    inputText.value.length > 0 && !timerStarted)
  ) {
    (timerStarted = !0), (setTimer.style.display = "block");
    let e = activeTab.innerHTML.trim();
    "15" === e
      ? startTimer(0, 15, result)
      : "30" === e
      ? startTimer(0, 30, result)
      : "60" === e
      ? startTimer(1, 0, result)
      : "120" === e && startTimer(2, 0, result);
  }
  (character += 1),
    (document.querySelector(".characters").innerHTML = `${character}`);
}),
  restartBtn.addEventListener("click", () => {
    clearInterval(timer),
      (setTimer.style.display = "none"),
      (document.getElementById("timer").textContent = "00 : 00"),
      (inputText.value = ""),
      startTyping(),
      restartBtn.classList.add("rotate"),
      restartBtn.addEventListener("animationend", () => {
        restartBtn.classList.remove("rotate");
      });
  }),
  document.querySelector(".fa-regular").addEventListener("click", () => {
    startTyping();
  }),
  seeNoti.addEventListener("click", () => {
    announceNotify.classList.toggle("display"),
      (announceNotify.style.opacity = "1"),
      bodyContent.forEach((e) => {
        (e.style.backgroundColor = "black"), (e.style.opacity = "0.5");
      }),
      window.addEventListener("click", (e) => {
        announceNotify.contains(e.target) ||
          seeNoti.contains(e.target) ||
          (announceNotify.classList.remove("display"),
          bodyContent.forEach((e) => {
            (e.style.backgroundColor = "#323437"), (e.style.opacity = "1");
          }));
      });
  });
const alreadySelected = (e) => {
  e.style.color = "#e2b714";
};
window.onload = () => {
  let e = document.getElementById("punctuation"),
    t = document.getElementById("time"),
    n = document.getElementById("30second");
  alreadySelected(e), alreadySelected(t), alreadySelected(n), (activeTab = n);
};
const tablinks = document.getElementsByClassName("tablink"),
  selectedTab = (e) => {
    ((clickedTab = e.target).style.color = "#e2b714"),
      activeTab && activeTab !== clickedTab && (activeTab.style.color = ""),
      (activeTab = clickedTab),
      (timerStarted = !1);
  };
for (let i = 0; i < tablinks.length; i++)
  tablinks[i].addEventListener("click", (e) => {
    clearInterval(timer),
      (document.getElementById("timer").textContent = "00 : 00"),
      selectedTab(e),
      (inputText.value = ""),
      startTyping(),
      (setTimer.style.display = "none");
  });
let timer;
const startTimer = (e, t, n) => {
  timer && clearInterval(timer),
    (timer = setInterval(() => {
      0 === t
        ? 0 === e
          ? (clearInterval(timer), n())
          : ((e -= 1), (t = 59))
        : (t -= 1);
      let r = e < 10 ? "0" + e : e,
        a = t < 10 ? "0" + t : t;
      document.getElementById("timer").textContent = `${r} : ${a}`;
    }, 1e3));
};
contact.addEventListener("click", () => {
  contactInfo.style.display = "flex";
}),
  window.addEventListener("click", (e) => {
    e.target === contactInfo && (contactInfo.style.display = "none");
  }),
  support.addEventListener("click", () => {
    supportInfo.style.display = "flex";
  }),
  window.addEventListener("click", (e) => {
    e.target === supportInfo && (supportInfo.style.display = "none");
  }),
  window.addEventListener("click", (e) => {
    e.target === typingResult &&
      ((typingResult.style.display = "none"),
      (inputText.value = ""),
      startTyping(),
      clearInterval(timer),
      (setTimer.style.display = "none"),
      (document.getElementById("timer").textContent = "00 : 00"));
  });
